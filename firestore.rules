
rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    // Helper to check if user is signed in
    function isSignedIn() {
      return request.auth != null;
    }

    // Broad rules for MVP: Allow all authenticated users to read and write
    // This ensures that onboarding, profile creation, and dashboard data fetching are not blocked.
    
    match /users/{userId} {
      allow read, write: if isSignedIn();
    }

    match /maintenanceRequests/{requestId} {
      allow read, write: if isSignedIn();
    }

    match /noticesToVacate/{noticeId} {
      allow read, write: if isSignedIn();
    }

    match /properties/{propertyId} {
      allow read, write: if isSignedIn();
    }

    match /tenants/{tenantId} {
      allow read, write: if isSignedIn();
    }

    match /payments/{paymentId} {
      allow read, write: if isSignedIn();
    }

    match /logs/{logId} {
      allow read, write: if isSignedIn();
    }

    match /communications/{commId} {
      allow read, write: if isSignedIn();
    }

    match /waterReadings/{readingId} {
      allow read, write: if isSignedIn();
    }

    match /tasks/{taskId} {
      allow read, write: if isSignedIn();
    }

    match /propertyOwners/{ownerId} {
      allow read, write: if isSignedIn();
    }

    match /landlords/{landlordId} {
      allow read, write: if isSignedIn();
    }

    match /archived_tenants/{tenantId} {
      allow read, write: if isSignedIn();
    }

    // Catch-all for other collections defined in the schema
    match /{document=**} {
      allow read, write: if isSignedIn();
    }
  }
}

// Deployment trigger: 2024-05-22T10:00:00Z
